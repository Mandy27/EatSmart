<!DOCTYPE html>
<html>
<head>
    <title>Virtue / Vice</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../css/list.css">
    <script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
    <script src="../js/jquery-1.11.3.min.js"></script>
    <script src="../js/Sortable.min.js"></script>
    <script src="../js/list.js"></script>
</head>
<body>
    <section>
        <h1>Habit List</h1>
        <ul id="habit-list" class="habit-list"></ul>
    </section>

    <button type="button" id="addHabit" onclick="addPageTransition();" title="add habit">+</button>


<script src="../js/jquery-1.11.3.min.js"></script>
<script src="../js/Sortable.min.js"></script>

<script type="text/javascript">
    var dataRef = new Firebase('https://burning-heat-9490.firebaseio.com/Habits');

    var habitList = $('#habit-list');

    /* Fetch habit list data */
    dataRef.on('child_added', function (snapshot) {
        // get data
        var data = snapshot.val();
        var title = data.title;
        var dailyfrequency = data.daily_frequency;
        var daycounter = 10;
        var record = 20;

        // create elements
        /*var habitElement = $("<li>");
        var titleElement = $("<div class='habit-name'></div>");
        var habitInfoElement = $("<ul class='habit-info></ul>");
        var dailyElement = $("<strong>");
        var counterElement = $("<strong>")
        var recordElement = $("<strong>");

        // inject html
        // title
        titleElement.text(title);
        //habitElement.text("message").prepend(titleElement);
        //habitElement.text(dailyfrequency).prepend(titleElement);
        habitElement.prepend(titleElement);

        // record counter
        counterElement.text(daycounter);
        recordElement.text(record);
        habitElement.append(counterElement);
        habitElement.append(" days in a row! Best Record: ");
        habitElement.append(recordElement);

        // progress bar
        habitElement.append(
            "<span class='message-total'> <svg height='25' width='150'> <line class='progress' x1='0' y1='0' x2='75' y2='0'                                                 style='stroke:rgba(65, 131, 215, 0.8);stroke-width:25' /> <line class='bar' x1='75' y1='0' x2='150' y2='0'                                                       style='stroke:rgba(171,171,171,0.6);stroke-width:25' /> </svg> </span>"
        );

        // daily frequency
        habitElement.append("<span class='message-today'>Completed <strong>1/</strong>");
        habitElement.append(dailyElement.text(dailyfrequency));
        habitElement.append(" for today!</span>");

        // update, edit, and delete buttons
        habitElement.append(
            "<div class='habit-op'> <button type='button' id='increment' class='op op-done' onclick='updateProgress(this);' title='done'> <img                               src='../img/done.svg' alt='Done'> </button> <button type='button' class='op op-edit' onclick='editPageTransition()' title='edit habit'> <img                     src='../img/edit.svg' alt='Edit'> </button> <button type='button' id='delete' class='op op-del' onclick='deleteHabit(this);' title='delete                       habit'> <img src='../img/delete.svg' alt='Del'> </button> </div>"
        );*/

        // add habit
        //habitList.prepend(habitElement);
        
        //create habit
        habitList.prepend(
            '<li>' +
                '<ul class="habit-info">' +
                    '<li><div class="habit-name">' + title + '</div></li>' +
                '</ul>' +
                '<div class="message">' +
            '</li>'
        );
    });
</script>
    <!--<script type="text/javascript">
        var el = document.getElementById('habit-list');
        var sortable = Sortable.create(el);
        
        $(window).load(function() {
            var habitList = document.getElementById('habit-list').children;

            for (var i = 0; i < habitList.length; i++){
                habitList[i].style.opacity = 0; 
                habitList[i].style.position = 'relative';
                habitList[i].style.right = '1000px';
            }
            fadeAllIn(); 
        });

        function fadeAllIn(){
            var habitList = document.getElementById('habit-list').children;
            var delay = 0; 

            for (var i = 0; i < habitList.length; i++){
                habitList[i].style.opacity = 1; 
                $(habitList[i]).delay(delay).animate({right: '0px'}, 750); 
                delay+=100; 
            }
        }

        function updateProgress(element){
            var msgElement = (element.parentNode.parentNode.getElementsByClassName("message-today"))[0];
            //alert(msgElement.innerHTML);
            $(msgElement).animate({opacity: 1}, 300); 
            //msgElement.style.visibility="visible";

            //Progress bar animation 
            var progress = element.parentNode.parentNode.getElementsByClassName('progress');
            var oldx2 = progress[0].getAttribute('x2'); 

            var bar = element.parentNode.parentNode.getElementsByClassName('bar');
            var oldx1 = bar[0].getAttribute('x1'); 

            /*Animates from the beginning of the bar 
            oldx2 = Number(oldx2) + 5;
            $(bar).animate(
                {x2: oldx2+'px'}, 
                {
                    duration: 750, 
                    step: function (now){ $(bar).attr('x2', now); }
                }
            );*/

            // Animates from current location on the bar 
            $({x2:oldx2}).animate(
                {x2: (Number(oldx2) + 5) + 'px'},
                {
                    duration:200,
                    step:function(now){$(progress).attr('x2', now);
                    queue: false; 
                }
            });

            $({x1:oldx1}).animate(
                {x1: (Number(oldx1) + 5) + 'px'},
                {
                    duration:200,
                    step:function(now){$(bar).attr('x1', now);
                    queue: false; 
                }
            });
        }
        
        function deleteHabit(element){
            var child = element.parentNode.parentNode;
            var parent = child.parentNode;

            /* Slides to the left of the screen to delete 
            child.style.position = 'relative'; 
            $(child).animate({right: '1000px'}, 750, function(){ $(child).remove();}); 
            */

            /* Slides up to delete */
            $(child).closest('li').slideUp('slow', function(){
                $(child).remove(); 
            }); 

            /* Fades out the child to delete
            $(child).fadeOut(500, function(){ $(this).remove();});
            */
        }

        function editPageTransition(){
            var habitList = document.getElementById('habit-list').children;
            var delay = 0; 
            //var n = child.nextElementSibling;
            console.log(habitList); 
            for (var i = 0; i < habitList.length; i++){
                console.log(habitList[i]); 
                /* Slides to the left of the screen to delete */
                habitList[i].style.position = 'relative'; 
                if (i != habitList.length - 1){
                    $(habitList[i]).delay(delay).animate({right: '1500px'}, 500); 
                    delay+=100; 
                }
                else{
                    $(habitList[i]).delay(delay).animate({right: '1500px'}, 500, function(){window.location.href='edit.html'}); 
                }
            }
        }

        function addPageTransition(){
            var habitList = document.getElementById('habit-list').children;
            var delay = 0; 
            for (var i = 0; i < habitList.length; i++){
                habitList[i].style.position = 'relative'; 
                if (i != habitList.length - 1){
                    $(habitList[i]).delay(delay).animate({right: '1500px'}, 500); 
                    delay+=100; 
                }
                else{
                    $(habitList[i]).delay(delay).animate({right: '1500px'}, 500, function(){window.location.href='add.html'}); 
                }
            }

            if (habitList.length == 0){
                window.location.href='add.html'; 
            }
        }
    </script> -->
</body>
</html>